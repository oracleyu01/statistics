# 예제57: 가설검정7 - 비모수적 가설 검정
## - 정규분포를 따르지 않는 경우

### 📊 가설검정의 유형
![가설검정의 유형](그림11.png)
![가설검정의 유형](table1.png)

[아래의 예제와 문제들을 수식으로 이해하기](https://chatgpt.com/share/678e58df-1868-8009-ae4b-10d74cd89cdc)

## 1️⃣ 비모수 검정 개요

##  왜 비모수 검정을 사용할까?
**비모수 검정(예: 윌콕슨 부호순위 검정)을 고려하는 이유**는 다음과 같다.

### 1️⃣ 샘플 크기가 작을 때
- 일반적으로 **샘플 크기 \( n < 30 \)**일 경우, 정규성 검정의 검정력이 낮을 수 있음.
- 귀무가설을 기각하지 못했다고 해서 **정확히 정규성을 따른다고 확신할 수 없음**.
- 따라서 **비모수 검정을 선택하면 더 신뢰할 수 있음**.

### 2️⃣ 이상치(Outliers)가 존재할 때
- 정규성을 따르더라도 **평균 기반 검정(t-검정)은 이상치에 민감**함.
- **비모수 검정(윌콕슨 검정)은 이상치의 영향을 덜 받음**.

### 3️⃣ 데이터의 분산이 다를 가능성이 있을 때
- 샘플 크기가 작을 경우 **등분산 검정을 수행하기 어려울 수 있음**.
- 정규성을 만족하더라도 **분산이 다를 가능성이 있다면 대응표본 t-검정보다 윌콕슨 검정이 더 적절할 수 있음**.

---

### 그러면 어떤 검정을 선택해야 할까?
| 조건 | 추천 검정 |
|------|--------------------------|
| 정규성을 만족하고, 샘플 크기가 충분히 크다면 | **대응표본 t-검정 (paired t-test)** |
| 샘플 크기가 작거나, 이상치가 존재한다면 | **윌콕슨 부호순위 검정 (Wilcoxon signed-rank test)** |

---

### 결론 🎯
- 단순히 **"정규성을 만족하니까 무조건 모수 검정을 해야 한다"**는 것은 성급한 판단일 수 있음.
- **샘플 크기, 이상치 여부, 분산 등을 종합적으로 고려**한 후 **대응표본 t-검정 vs 윌콕슨 검정** 중 선택해야 함.

> **🔍 추가 확인 필요:**  
> - 샘플 크기가 충분한지?
> - 이상치가 있는지?
> - 등분산성이 보장되는지?


## 1. Shapiro-Wilk 정규성 검정 결과



### 주요 비모수 검정 방법
| 모수적 방법 | 비모수적 방법 | 용도 |
|------------|--------------|------|
| 일표본 t검정 | 부호검정, 윌콕슨 부호순위검정 | 한 집단의 중앙값 검정 |
| 독립표본 t검정 | 만-휘트니 U검정(윌콕슨 순위합) | 두 독립집단의 비교 |
| 대응표본 t검정 | 윌콕슨 부호순위검정 | 대응표본의 비교 |
| 일원분산분석 | 크루스칼-왈리스 검정 | 세 개 이상 독립집단의 비교 |

## 2️⃣ 주요 비모수 검정 예제

### 📌 예제 1: 윌콕슨 부호순위검정  

고혈압 치료제의 효과를 확인하기 위해 10명의 환자를 대상으로 복용 전후의 혈압을 측정하였다.  
각 환자의 치료 전과 치료 후 혈압 차이가 유의미한지 확인하고자 한다.  
이 문제에서는 복용 전후의 혈압 차이가 통계적으로 유의미한 차이가 있는지 검정하는 것을 목표로 한다.

#### **문제 설명**  
고혈압 치료제의 효과를 평가하기 위해, 10명의 환자에게 치료 전과 후의 혈압을 측정하였다.  
치료 전 혈압과 치료 후 혈압의 차이를 비교하여, 치료가 혈압에 유의미한 영향을 미쳤는지 확인하려고 한다.

#### **분석하고자 하는 가설**
- **귀무가설 (H₀)**: "혈압 복용 전과 후 차이는 없다." (치료가 혈압에 영향을 미치지 않는다.)
- **대립가설 (H₁)**: "혈압 복용 전과 후 차이가 있다." (치료가 혈압에 영향을 미친다.)

#### **데이터**
- **before**: 치료 전의 혈압 (단위: mmHg)
- **after**: 치료 후의 혈압 (단위: mmHg)

#### **검정 방법**
1. **정규성 검정**: 치료 전후의 혈압 차이가 정규분포를 따르는지 확인
2. **쌍체 검정 (대응표본 t-검정)**: 치료 전후 혈압 차이를 비교하여, 혈압의 변화가 통계적으로 유의미한지 검정



```r
# 데이터
before <- c(150, 145, 160, 155, 148, 152, 158, 142, 156, 151)
after <- c(142, 140, 155, 150, 145, 148, 152, 140, 152, 147)

# 정규성 검정
shapiro.test(before - after)  # 정규성 검정

# 윌콕슨 부호순위검정
wilcox.test(before, after, paired=TRUE)

# 시각화
boxplot(list(Before=before, After=after),
        main="치료제 복용 전후 혈압 비교")
```

### 📌 예제 2: 만-휘트니 U검정  

두 가지 다른 교육 방법으로 학습한 학생들의 성취도를 비교한다.

#### **문제 설명**  
두 가지 교육 방법(method_A, method_B)을 사용하여 학습한 학생들의 성취도를 비교하고자 한다.  
각 교육 방법을 따른 학생들의 성적을 비교하여 두 방법 간에 성취도에 유의미한 차이가 있는지 검정하려고 한다.

#### **분석하고자 하는 가설**
- **귀무가설 (H₀)**: "두 교육 방법의 성취도 차이는 없다." (교육 방법 간 성취도 차이가 없다.)
- **대립가설 (H₁)**: "두 교육 방법의 성취도 차이가 있다." (교육 방법 간 성취도에 차이가 있다.)

#### **데이터**
- **method_A**: 교육 방법 A를 따른 학생들의 성취도
- **method_B**: 교육 방법 B를 따른 학생들의 성취도

#### **검정 방법**
1. **만-훼트니 U검정**: 두 교육 방법 간 성취도의 차이가 유의미한지 확인

#### **코드 예시**
```r
# 데이터
method_A <- c(85, 78, 82, 88, 94, 75, 85, 82)
method_B <- c(75, 72, 68, 80, 76, 70, 74, 78)

# 만-훼트니 U검정
wilcox.test(method_A, method_B)

# 시각화
boxplot(list(A=method_A, B=method_B), 
        main="교육 방법별 성취도 비교")


```r
# 데이터
method_A <- c(85, 78, 82, 88, 94, 75, 85, 82)
method_B <- c(75, 72, 68, 80, 76, 70, 74, 78)

# 만-휘트니 U검정
wilcox.test(method_A, method_B)

# 시각화
boxplot(list(A=method_A, B=method_B),
        main="교육 방법별 성취도 비교")
```

### 📌 예제 3: 크루스칼-왈리스 검정  

세 가지 다른 운동 프로그램의 효과를 비교한다.

#### **문제 설명**  
세 가지 운동 프로그램(program_A, program_B, program_C)을 사용하여 운동 효과를 비교하고자 한다. 각 운동 프로그램을 따른 학생들의 성취도를 비교하여, 세 프로그램 간에 유의미한 차이가 있는지 검정하려고 한다.

#### **분석하고자 하는 가설**
- **귀무가설 (H₀)**: "세 운동 프로그램 간에 성취도 차이는 없다." (운동 프로그램 간 성취도 차이가 없다.)
- **대립가설 (H₁)**: "세 운동 프로그램 간에 성취도 차이가 있다." (운동 프로그램 간 성취도에 차이가 있다.)

#### **데이터**
- **program_A**: 운동 프로그램 A를 따른 학생들의 성취도
- **program_B**: 운동 프로그램 B를 따른 학생들의 성취도
- **program_C**: 운동 프로그램 C를 따른 학생들의 성취도

#### **검정 방법**
1. **크루스칼-왈리스 검정**: 세 운동 프로그램 간 성취도의 차이가 유의미한지 확인

#### **코드 예시**
```r
# 데이터 준비
program_A <- c(5.2, 4.8, 5.5, 4.9, 5.1)
program_B <- c(4.8, 4.5, 5.9, 4.6, 4.7)
program_C <- c(5.5, 5.8, 5.6, 5.7, 5.9)

# 데이터프레임 생성
data <- data.frame(
  effect = c(program_A, program_B, program_C),
  program = factor(rep(c("A", "B", "C"), each=5))
)

# 크루스칼-왈리스 검정
kruskal.test(effect ~ program, data=data)

# 시각화
boxplot(effect ~ program, data=data,
        main="프로그램별 효과 비교")


```r
# 데이터 준비
program_A <- c(5.2, 4.8, 5.5, 4.9, 5.1)
program_B <- c(4.8, 4.5, 4.9, 4.6, 4.7)
program_C <- c(5.5, 5.8, 5.6, 5.7, 5.9)

# 데이터프레임 생성
data <- data.frame(
  effect = c(program_A, program_B, program_C),
  program = factor(rep(c("A", "B", "C"), each=5))
)

# 크루스칼-왈리스 검정
kruskal.test(effect ~ program, data=data)

# 시각화
boxplot(effect ~ program, data=data,
        main="프로그램별 효과 비교")
```

## 3️⃣ 연습문제

<details>
<summary><b>🎯 문제 1: 윌콕슨 부호순위검정</b></summary>

새로운 수면제의 효과를 검증하기 위해 8명의 불면증 환자를 대상으로 복용 전후의 수면 시간(시간)을 측정했다.
유의수준 5%에서 수면제가 효과가 있는지 검정하시오.

```
복용 전: 5.2, 4.8, 5.0, 4.5, 4.9, 5.1, 4.7, 4.6
복용 후: 6.1, 5.9, 5.8, 5.5, 6.0, 5.7, 5.6, 5.8
```
</details>

<details>
<summary><b>✍️ 문제 1 정답</b></summary>

```r
# 데이터 입력
before <- c(5.2, 4.8, 5.0, 4.5, 4.9, 5.1, 4.7, 4.6)
after <- c(6.1, 5.9, 5.8, 5.5, 6.0, 5.7, 5.6, 5.8)

# 정규성 검정
shapiro.test(after - before)

# 윌콕슨 부호순위검정
result <- wilcox.test(after, before, 
                      paired=TRUE, 
                      alternative="greater")
print(result)

# 결론: p-value < 0.05이므로 수면제가 효과가 있다고 할 수 있다
```
</details>

<details>
<summary><b>🎯 문제 2: 만-휘트니 U검정</b></summary>

두 약국에서 판매하는 동일한 약품의 가격을 비교하고자 한다. 
각 약국에서 10개의 약품 가격을 조사했다. 
유의수준 5%에서 두 약국의 가격에 차이가 있는지 검정하시오.

```
약국 A: 5200, 4800, 5500, 4900, 5100, 5300, 4700, 5000, 5400, 4900
약국 B: 4800, 4500, 4900, 4600, 4700, 4800, 4400, 4700, 4900, 4600
```
</details>

<details>
<summary><b>✍️ 문제 2 정답</b></summary>

```r
# 데이터 입력
pharmacy_A <- c(5200, 4800, 5500, 4900, 5100, 5300, 4700, 5000, 5400, 4900)
pharmacy_B <- c(4800, 4500, 4900, 4600, 4700, 4800, 4400, 4700, 4900, 4600)

# 만-휘트니 U검정
result <- wilcox.test(pharmacy_A, pharmacy_B)
print(result)

# 시각화
boxplot(list(A=pharmacy_A, B=pharmacy_B),
        main="약국별 약품 가격 비교",
        ylab="가격(원)")

# 결론: p-value < 0.05이므로 두 약국의 가격에 유의한 차이가 있다
```
</details>

> 💡 **핵심 포인트**
> - 정규성 가정이 충족되지 않을 때 비모수 검정을 사용합니다
> - 비모수 검정은 데이터의 순위를 사용합니다
> - 표본 크기가 작을 때 특히 유용합니다
> - R에서는 wilcox.test(), kruskal.test() 등의 함수를 사용합니다
> - 검정 전에 항상 데이터의 특성을 확인해야 합니다
