# 예제57: 가설검정7 - 비모수적 가설 검정
## - 정규분포를 따르지 않는 경우

### 📊 가설검정의 유형
![가설검정의 유형](그림11.png)
![가설검정의 유형](table1.png)

## 비모수 검정(Non-Parametric Test)의 유래와 활용

### 📌 비모수 검정이란?
비모수 검정(Non-Parametric Test)은 **데이터가 특정한 분포(정규분포 등)를 따른다는 가정을 하지 않는 통계적 검정 방법**입니다.  
일반적인 모수 검정(Parametric Test)은 모집단이 정규성을 가지거나 특정 분포를 따른다고 가정하지만, 비모수 검정은 **데이터의 분포에 대한 가정 없이 적용 가능**합니다.

---

### 📜 비모수 검정의 유래
비모수 검정은 **20세기 초반**에 개발되었으며, 특히 **R.A. Fisher(1890-1962)** 와 **John Tukey(1915-2000)** 등의 통계학자들이 데이터의 분포를 가정하지 않는 방법을 연구하면서 발전하였습니다.  
주요 기여자는 다음과 같습니다:

- **Wilcoxon (1945)**: 윌콕슨 부호순위검정(Wilcoxon Signed-Rank Test)을 개발하여 대응표본의 차이를 분석하는 방법을 제시.
- **Mann & Whitney (1947)**: 만-휘트니 U검정(Mann-Whitney U Test)을 개발하여 두 개의 독립된 그룹을 비교할 수 있도록 함.
- **Kruskal & Wallis (1952)**: 크루스칼-왈리스 검정(Kruskal-Wallis Test)을 제안하여 여러 개의 독립 그룹을 비교하는 방법을 정립.

---

### 🎯 비모수 검정이 필요한 경우 (활용 시점)
다음과 같은 경우에 비모수 검정을 활용하면 유용합니다.

#### 1️⃣ 데이터가 정규성을 따르지 않을 때
- 샤피로-윌크 검정(Shapiro-Wilk Test)이나 콜모고로프-스미르노프 검정(Kolmogorov-Smirnov Test) 결과에서 **정규성이 기각**되면 비모수 검정을 고려해야 합니다.
- 예시: 극단값(outlier)이 많거나, 데이터가 심하게 왜곡된 경우.

#### 2️⃣ 표본 크기가 작을 때
- 일반적으로 표본 크기가 **30개 미만**일 경우, 정규성을 따르지 않는 경우가 많기 때문에 비모수 검정을 활용하는 것이 유리합니다.
- 예시: 임상 시험에서 모집단이 적을 때.

#### 3️⃣ 서열형(ordinal) 데이터일 때
- 순위(서열) 데이터처럼 평균이나 분산을 계산하기 어려운 경우, 비모수 검정을 사용하여 비교 분석을 수행합니다.
- 예시: 고객 만족도(1점~5점 척도), 설문 조사 응답(매우 좋음~매우 나쁨).

#### 4️⃣ 등간척도(interval scale) 이상이 아닌 경우
- 등간척도(interval scale) 이상이어야 평균과 표준편차를 신뢰할 수 있지만, 서열척도(ordinal scale) 또는 명목척도(nominal scale) 데이터의 경우 비모수 검정이 적절합니다.
- 예시: "가장 좋아하는 색상", "선호하는 브랜드" 등 명목형 변수.

#### 5️⃣ 이상치(outlier)가 많을 때
- 데이터셋에 극단값이 포함되어 있으면 평균과 표준편차가 왜곡될 수 있습니다. 이러한 경우 **중앙값(median)** 기반의 비모수 검정을 사용하면 보다 신뢰할 수 있는 결과를 얻을 수 있습니다.
- 예시: 부유층과 저소득층의 소득 비교.

---

### 🔍 대표적인 비모수 검정 방법
| 검정 종류 | 대응되는 모수 검정 | 사용 예시 |
|-----------|-----------------|----------------|
| **윌콕슨 부호순위검정** (Wilcoxon Signed-Rank Test) | 대응표본 t-검정 (Paired t-test) | 같은 그룹의 전후 비교 (예: 치료 전후 혈압 비교) |
| **만-휘트니 U검정** (Mann-Whitney U Test) | 독립표본 t-검정 (Independent t-test) | 두 그룹 비교 (예: 남녀 간 키 차이) |
| **크루스칼-왈리스 검정** (Kruskal-Wallis Test) | 일원배치 분산분석(ANOVA) | 세 그룹 이상 비교 (예: 세 개의 치료 그룹 비교) |
| **프리드만 검정** (Friedman Test) | 반복측정 분산분석 (Repeated Measures ANOVA) | 동일한 피험자 집단의 반복 측정 비교 |

---

### ✅ 결론
- **비모수 검정은 데이터가 정규성을 따르지 않을 때 강력한 대안**이 될 수 있습니다.
- **소규모 표본, 서열 데이터, 이상치가 존재하는 경우에도 안정적인 분석 가능**.
- 특정 상황에서 비모수 검정은 모수 검정보다 더 신뢰할 수 있는 결과를 제공할 수 있습니다.

👉 **정규성을 만족하는 경우에는 모수 검정이 더 강력하지만, 비모수 검정은 보다 폭넓은 데이터 유형을 다룰 수 있는 장점이 있습니다!**

## 주요 비모수 검정 예제

### 📌 예제 1: 윌콕슨 부호순위검정  

고혈압 치료제의 효과를 확인하기 위해 10명의 환자를 대상으로 복용 전후의 혈압을 측정하였다.  
각 환자의 치료 전과 치료 후 혈압 차이가 유의미한지 확인하고자 한다.  
이 문제에서는 복용 전후의 혈압 차이가 통계적으로 유의미한 차이가 있는지 검정하는 것을 목표로 한다.

#### **문제 설명**  
고혈압 치료제의 효과를 평가하기 위해, 10명의 환자에게 치료 전과 후의 혈압을 측정하였다.  
치료 전 혈압과 치료 후 혈압의 차이를 비교하여, 치료가 혈압에 유의미한 영향을 미쳤는지 확인하려고 한다.

#### **분석하고자 하는 가설**
- **귀무가설 (H₀)**: "혈압 복용 전과 후 차이는 없다." (치료가 혈압에 영향을 미치지 않는다.)
- **대립가설 (H₁)**: "혈압 복용 전과 후 차이가 있다." (치료가 혈압에 영향을 미친다.)

#### **데이터**
- **before**: 치료 전의 혈압 (단위: mmHg)
- **after**: 치료 후의 혈압 (단위: mmHg)

#### **검정 방법**
1. **정규성 검정**: 치료 전후의 혈압 차이가 정규분포를 따르는지 확인
2. **쌍체 검정 (대응표본 t-검정)**: 치료 전후 혈압 차이를 비교하여, 혈압의 변화가 통계적으로 유의미한지 검정



```r
# 데이터 
before <- c(150, 145, 160, 155, 148, 152, 158, 142, 300, 310)  # 극단값 추가
after <- c(142, 140, 155, 150, 145, 148, 152, 140, 100, 90)   # 극단값 추가


```

### 📌 예제 2: 만-휘트니 U검정  

두 가지 다른 교육 방법으로 학습한 학생들의 성취도를 비교한다.   

### 윌콕슨 부호순위검정(Wilcoxon Signed-Rank Test) vs 만-휘트니 U검정(Mann-Whitney U Test)

두 검정은 **비모수 검정(non-parametric test)**으로, 데이터가 정규성을 따르지 않을 때 사용할 수 있습니다. 하지만 적용되는 데이터 유형과 가정이 다릅니다.

---

### 1. 윌콕슨 부호순위검정 (Wilcoxon Signed-Rank Test)

### ✅ 개념
- **두 개의 관련된(쌍을 이루는) 데이터** 집단에서 차이가 있는지 검정합니다.
- 대응표본 t-검정(Paired t-test)의 비모수 대안입니다.
- 차이값(두 집단의 차이)을 순위화한 후, 부호(+, -)를 고려하여 분석합니다.

### ✅ 사용 조건
- **대응표본(쌍을 이룬 데이터, paired samples)**: 같은 사람(또는 개체)에서 측정한 전후 비교 데이터가 있을 때 사용합니다.
- 정규성을 가정하지 않지만, 차이값이 대략 대칭성을 가지면 좋습니다.

### ✅ 예시
- 치료 전후의 혈압 비교
- 학생들의 시험 전후 점수 변화
- 같은 환자의 약물 복용 전후 체중 변화

### ✅ R 코드 예시
```r
wilcox.test(before, after, paired=TRUE)
```

---

### 2. 만-휘트니 U검정 (Mann-Whitney U Test)

### ✅ 개념
- **독립된 두 개의 그룹 간 차이**를 검정합니다.
- 독립표본 t-검정(Independent t-test)의 비모수 대안입니다.
- 두 그룹의 데이터가 동일한 분포를 따르는지 비교하며, 중위수 차이를 분석합니다.

### ✅ 사용 조건
- **독립표본(Independent samples)**: 두 그룹이 서로 다른 개체일 때 사용합니다.
- 정규성을 가정하지 않으며, 그룹의 크기가 달라도 됩니다.

### ✅ 예시
- 남성과 여성의 키 비교
- 두 개의 다른 치료 그룹의 효과 비교
- 두 회사 직원들의 연봉 비교

### ✅ R 코드 예시
```r
wilcox.test(group1, group2, paired=FALSE)
```
> `paired=FALSE` 옵션을 사용하여 두 그룹이 독립적임을 명시합니다.

---

### 📌 차이점 요약

|  | **윌콕슨 부호순위검정 (Wilcoxon Signed-Rank Test)** | **만-휘트니 U검정 (Mann-Whitney U Test)** |
|---|--------------------------------------|--------------------------------|
| **데이터 유형** | 같은 대상에서 측정한 **쌍(pair) 데이터** | 서로 독립적인 두 개의 그룹 |
| **비모수 대안** | 대응표본 t-검정 (Paired t-test) | 독립표본 t-검정 (Independent t-test) |
| **예시** | 치료 전후 혈압 변화, 시험 전후 점수 비교 | 남녀 평균 키 비교, A/B 테스트 결과 비교 |
| **순위화 방식** | 차이값을 순위화하고 부호 고려 | 개별 데이터의 순위를 비교 |
| **R 코드** | `wilcox.test(before, after, paired=TRUE)` | `wilcox.test(group1, group2, paired=FALSE)` |

---

### 🎯 언제 어떤 검정을 사용해야 할까?

- **같은 개체의 전후 비교** → **윌콕슨 부호순위검정**
- **서로 독립적인 두 집단 비교** → **만-휘트니 U검정**


#### **문제 설명**  
두 가지 교육 방법(method_A, method_B)을 사용하여 학습한 학생들의 성취도를 비교하고자 한다.  
각 교육 방법을 따른 학생들의 성적을 비교하여 두 방법 간에 성취도에 유의미한 차이가 있는지 검정하려고 한다.

#### **분석하고자 하는 가설**
- **귀무가설 (H₀)**: "두 교육 방법의 성취도 차이는 없다." (교육 방법 간 성취도 차이가 없다.)
- **대립가설 (H₁)**: "두 교육 방법의 성취도 차이가 있다." (교육 방법 간 성취도에 차이가 있다.)

#### **데이터**
- **method_A**: 교육 방법 A를 따른 학생들의 성취도
- **method_B**: 교육 방법 B를 따른 학생들의 성취도

#### **검정 방법**
1. **만-훼트니 U검정**: 두 교육 방법 간 성취도의 차이가 유의미한지 확인

#### **코드 예시**
```r
# 데이터
method_A <- c(85, 78, 82, 88, 94, 75, 85, 82)
method_B <- c(75, 72, 68, 80, 76, 70, 74, 78)





```

### 📌 예제 3: 크루스칼-왈리스 검정  

세 가지 다른 운동 프로그램의 효과를 비교한다.

#### **문제 설명**  
세 가지 운동 프로그램(program_A, program_B, program_C)을 사용하여 운동 효과를 비교하고자 한다. 각 운동 프로그램을 따른 학생들의 성취도를 비교하여, 세 프로그램 간에 유의미한 차이가 있는지 검정하려고 한다.

#### **분석하고자 하는 가설**
- **귀무가설 (H₀)**: "세 운동 프로그램 간에 성취도 차이는 없다." (운동 프로그램 간 성취도 차이가 없다.)
- **대립가설 (H₁)**: "세 운동 프로그램 간에 성취도 차이가 있다." (운동 프로그램 간 성취도에 차이가 있다.)

#### **데이터**
- **program_A**: 운동 프로그램 A를 따른 학생들의 성취도
- **program_B**: 운동 프로그램 B를 따른 학생들의 성취도
- **program_C**: 운동 프로그램 C를 따른 학생들의 성취도

#### **검정 방법**
1. **크루스칼-왈리스 검정**: 세 운동 프로그램 간 성취도의 차이가 유의미한지 확인

#### **코드 예시**
```r
# 데이터 준비
program_A <- c(5.2, 4.8, 5.5, 4.9, 5.1)
program_B <- c(4.8, 4.5, 5.9, 4.6, 4.7)
program_C <- c(5.5, 5.8, 5.6, 5.7, 5.9)




```

## 3️⃣ 연습문제

<details>
<summary><b>🎯 문제 1: 윌콕슨 부호순위검정</b></summary>

새로운 수면제의 효과를 검증하기 위해 8명의 불면증 환자를 대상으로 복용 전후의 수면 시간(시간)을 측정했다.
유의수준 5%에서 수면제가 효과가 있는지 검정하시오.

```
복용 전: 5.2, 4.8, 5.0, 4.5, 4.9, 5.1, 4.7, 4.6
복용 후: 6.1, 5.9, 5.8, 5.5, 6.0, 5.7, 5.6, 5.8
```
</details>

<details>
<summary><b>✍️ 문제 1 정답</b></summary>

```r
# 데이터 입력
before <- c(5.2, 4.8, 5.0, 4.5, 4.9, 5.1, 4.7, 4.6)
after <- c(6.1, 5.9, 5.8, 5.5, 6.0, 5.7, 5.6, 5.8)


```
</details>

<details>
<summary><b>🎯 문제 2: 만-휘트니 U검정</b></summary>

두 약국에서 판매하는 동일한 약품의 가격을 비교하고자 한다. 
각 약국에서 10개의 약품 가격을 조사했다. 
유의수준 5%에서 두 약국의 가격에 차이가 있는지 검정하시오.

```
약국 A: 5200, 4800, 5500, 4900, 5100, 5300, 4700, 5000, 5400, 4900
약국 B: 4800, 4500, 4900, 4600, 4700, 4800, 4400, 4700, 4900, 4600
```
</details>

<details>
<summary><b>✍️ 문제 2 정답</b></summary>

```r
# 데이터 입력
pharmacy_A <- c(5200, 4800, 5500, 4900, 5100, 5300, 4700, 5000, 5400, 4900)
pharmacy_B <- c(4800, 4500, 4900, 4600, 4700, 4800, 4400, 4700, 4900, 4600)


```
</details>

> 💡 **핵심 포인트**
> - 정규성 가정이 충족되지 않을 때 비모수 검정을 사용합니다
> - 비모수 검정은 데이터의 순위를 사용합니다
> - 표본 크기가 작을 때 특히 유용합니다
> - R에서는 wilcox.test(), kruskal.test() 등의 함수를 사용합니다
> - 검정 전에 항상 데이터의 특성을 확인해야 합니다
